âœ… 1. Pessoa (cliente) nÃ£o aparece
ğŸ” Erro detectado:

txt
Copiar
Editar
ğŸ” Resultado: Cliente nÃ£o encontrado
ğŸ”§ Causa:
No payload da tarefa, estÃ¡ enviando person_id com undefined ou um ID nÃ£o cadastrado. Isso quebra o PUT.

âœ… SoluÃ§Ã£o:
Verifique se estÃ¡ enviando assim:

ts
Copiar
Editar
person_id: tarefa.person?.id || null
E garanta que a lista de pessoas tenha sido carregada corretamente. Use este endpoint com include=phones:

ts
Copiar
Editar
GET /api/v2/people?include=phones
âœ… 2. PUT da tarefa estÃ¡ dando 400 Bad Request
ğŸ” Erro detectado:

http
Copiar
Editar
PUT /api/monde/tarefas/e77068cc... â†’ 400 (Bad Request)
ğŸ”§ Causa provÃ¡vel:
Campos obrigatÃ³rios (status_id, person_id, company_id) estÃ£o undefined.

âœ… SoluÃ§Ã£o:
Antes de enviar o PUT, monte um payload completo e seguro:

ts
Copiar
Editar
const payload = {
  name: tarefa.name,
  description: tarefa.description || '',
  status_id: tarefa.status?.id || statusPadraoId,
  person_id: tarefa.person?.id || null,
  company_id: tarefa.company?.id || usuario.company_id,
  category_id: tarefa.category?.id || null,
  due: tarefa.due || new Date().toISOString(),
  completed: tarefa.completed || false,
};
âœ… 3. HistÃ³rico dÃ¡ erro 415 (Unsupported Media Type)
ğŸ” Erro detectado:

http
Copiar
Editar
POST /api/monde/tarefas/:id/historico â†’ 415 (Unsupported Media Type)
ğŸ”§ Causa:
VocÃª estÃ¡ enviando o POST sem o header Content-Type: application/json.

âœ… SoluÃ§Ã£o:
Altere sua requisiÃ§Ã£o para:

ts
Copiar
Editar
await fetch(`/api/monde/tarefas/${tarefa.id}/historico`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${token}`,
  },
  body: JSON.stringify({
    description: novoHistorico,
  }),
});
âœ… 4. status estÃ¡ undefined
ğŸ” Log visÃ­vel:

txt
Copiar
Editar
Debug tarefa: { completed: false, status: undefined }
ğŸ”§ Causa:
VocÃª nÃ£o estÃ¡ setando o status ao criar a tarefa ou ao editar se o dropdown nÃ£o for interagido.

âœ… SoluÃ§Ã£o:
Defina um status padrÃ£o no carregamento da tarefa:

ts
Copiar
Editar
if (!tarefa.status && listaDeStatus.length) {
  tarefa.status = listaDeStatus.find(s => s.name === 'Novo') || listaDeStatus[0];
}
âœ… 5. A modal nÃ£o fecha apÃ³s salvar
ğŸ” Causa:
A funÃ§Ã£o saveAndCloseModal sÃ³ fecha se tudo der certo, mas estÃ¡ falhando silenciosamente se o histÃ³rico der erro.

âœ… SoluÃ§Ã£o:
Adicione try/catch isolado para salvar o histÃ³rico e deixe o fechamento da modal acontecer mesmo se o histÃ³rico der erro:

ts
Copiar
Editar
try {
  await salvarHistorico(tarefa.id, historico);
} catch (err) {
  console.error("Erro ao salvar histÃ³rico:", err);
}
// Feche a modal mesmo assim
setIsModalAberta(false);
âœ… 6. Cliente / Empresa nÃ£o aparecem no card da tarefa
ğŸ”§ Causa:
No componente de listagem ou modal, vocÃª estÃ¡ acessando tarefa.person.name e tarefa.company.name mas os objetos person e company nÃ£o estÃ£o populados.

âœ… SoluÃ§Ã£o:
VocÃª precisa popular os relacionamentos ao buscar as tarefas:

ts
Copiar
Editar
GET /api/v2/tasks?include=person,company,status,category
Ou ao carregar a tarefa individual:

ts
Copiar
Editar
GET /api/v2/tasks/:id?include=person,company
âœ… 7. HistÃ³rico nÃ£o aparece
ğŸ”§ Causa:
VocÃª nÃ£o estÃ¡ buscando o histÃ³rico corretamente (ou nÃ£o associa com o ID da tarefa).

âœ… SoluÃ§Ã£o:

ts
Copiar
Editar
GET /api/v2/task_historics?filter[task_id]=e77068cc...
E renderize com:

tsx
Copiar
Editar
historicos.map(h => <p key={h.id}>{h.description}</p>)
âœ… 8. PUT estÃ¡ sendo chamado a cada onChange (automÃ¡tico)
ğŸ”§ Causa:
VocÃª estÃ¡ salvando a tarefa enquanto ainda digita no campo.

âœ… SoluÃ§Ã£o:
Separe handleChange de saveChanges e sÃ³ envie o PUT quando clicar no botÃ£o Salvar.

