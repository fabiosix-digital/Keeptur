# Guia: Diferenciar Tarefas Conclu√≠das e Deletadas na API do Monde

## PROBLEMA IDENTIFICADO
A API do Monde (`https://web.monde.com.br/api/v2`) n√£o diferencia claramente tarefas "conclu√≠das" e "deletadas" nos endpoints padr√£o. Preciso implementar uma solu√ß√£o para distinguir esses dois status.

## ESTRUTURA DA API MONDE

### Autentica√ß√£o
```bash
curl "https://web.monde.com.br/api/v2/tokens" \
  -d '{"data": {"type": "tokens", "attributes": {"login": "SEU_LOGIN", "password": "SUA_SENHA"}}}' \
  -X POST \
  -H "Accept: application/vnd.api+json" \
  -H "Content-Type: application/vnd.api+json"
```

### Endpoints de Tarefas Dispon√≠veis
- `GET /api/v2/tasks` - Listar tarefas
- `GET /api/v2/tasks/:id` - Visualizar tarefa espec√≠fica
- `POST /api/v2/tasks` - Criar nova tarefa
- `PATCH /api/v2/tasks/:id` - Atualizar tarefa
- `DELETE /api/v2/tasks/:id` - Deletar tarefa

## ESTRAT√âGIAS PARA DIFERENCIAR STATUS

### Estrat√©gia 1: An√°lise de Campos de Status
```javascript
// IMPLEMENTAR: Verificar se existe campo 'status' ou 'state' na resposta das tarefas
async function getTasks(token) {
  const response = await fetch('https://web.monde.com.br/api/v2/tasks', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Accept': 'application/vnd.api+json',
      'Content-Type': 'application/vnd.api+json'
    }
  });
  
  const data = await response.json();
  
  // ANALISAR: Verificar se existe campo status nos attributes
  data.data.forEach(task => {
    console.log('Task attributes:', task.attributes);
    // Procurar por: status, state, completed, finished, deleted, archived
  });
  
  return data;
}
```

### Estrat√©gia 2: Usar Filtros Espec√≠ficos da API Monde (PRIORIT√ÅRIO)
```javascript
// IMPLEMENTAR: Filtros baseados na interface do Monde
const endpoints_filtros_monde = [
  // Filtro por situa√ß√£o (CAMPO CONFIRMADO)
  '/api/v2/tasks?filter[situacao]=ativa',
  '/api/v2/tasks?filter[situacao]=concluida', 
  '/api/v2/tasks?filter[situacao]=excluida',
  '/api/v2/tasks?filter[situation]=active',
  '/api/v2/tasks?filter[situation]=completed',
  '/api/v2/tasks?filter[situation]=deleted',
  
  // Alternativas de filtro
  '/api/v2/tasks?situacao=concluida',
  '/api/v2/tasks?situation=deleted',
  '/api/v2/tasks?status=completed'
];

// FUN√á√ÉO ESPEC√çFICA PARA MONDE
async function getTasksBySituation(token, situacao) {
  const url = `https://web.monde.com.br/api/v2/tasks?filter[situacao]=${situacao}`;
  
  try {
    const response = await fetch(url, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Accept': 'application/vnd.api+json',
        'Content-Type': 'application/vnd.api+json'
      }
    });
    
    const data = await response.json();
    console.log(`Tarefas com situa√ß√£o "${situacao}":`, data);
    return data;
  } catch (error) {
    console.error(`Erro ao buscar tarefas ${situacao}:`, error);
  }
}

// TESTE ESPEC√çFICO PARA OS 3 STATUS
async function testarFiltrosSituacao(token) {
  console.log('=== TESTANDO FILTROS DE SITUA√á√ÉO ===');
  
  const situacoes = ['ativa', 'concluida', 'excluida'];
  
  for (const situacao of situacoes) {
    console.log(`\n--- Testando situa√ß√£o: ${situacao} ---`);
    await getTasksBySituation(token, situacao);
  }
  
  // Testar tamb√©m em ingl√™s
  const situations = ['active', 'completed', 'deleted'];
  
  for (const situation of situations) {
    console.log(`\n--- Testing situation: ${situation} ---`);
    const url = `https://web.monde.com.br/api/v2/tasks?filter[situation]=${situation}`;
    
    try {
      const response = await fetch(url, {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.api+json',
          'Content-Type': 'application/vnd.api+json'
        }
      });
      
      const data = await response.json();
      console.log(`Tasks with situation "${situation}":`, data);
    } catch (error) {
      console.error(`Error fetching ${situation} tasks:`, error);
    }
  }
}
```

### Estrat√©gia 3: Verificar Relacionamentos
```javascript
// IMPLEMENTAR: Analisar relationships para status ou categorias
function analyzeTaskRelationships(task) {
  if (task.relationships) {
    // Verificar se existe relacionamento com status/categoria
    const possibleStatusRelations = [
      'status', 'state', 'category', 'task-category', 'workflow-status'
    ];
    
    possibleStatusRelations.forEach(relation => {
      if (task.relationships[relation]) {
        console.log(`Found status relation: ${relation}`, task.relationships[relation]);
      }
    });
  }
}
```

### Estrat√©gia 4: Usar Task Categories para Status
```javascript
// IMPLEMENTAR: Usar categories como status
async function getTaskCategories(token) {
  const response = await fetch('https://web.monde.com.br/api/v2/task-categories', {
    method: 'GET',
    headers: {
      'Authorization': `Bearer ${token}`,
      'Accept': 'application/vnd.api+json',
      'Content-Type': 'application/vnd.api+json'
    }
  });
  
  const categories = await response.json();
  
  // PROCURAR categorias como: "Conclu√≠do", "Finalizado", "Deletado", "Arquivado"
  return categories.data;
}
```

### Estrat√©gia 5: Implementar Sistema de Status Pr√≥prio
```javascript
// SOLU√á√ÉO ALTERNATIVA: Criar sistema pr√≥prio de controle
class TaskStatusManager {
  constructor() {
    this.statusMapping = new Map();
    this.deletedTasks = new Set();
    this.completedTasks = new Set();
  }
  
  // Marcar tarefa como conclu√≠da (sem deletar da API)
  async markAsCompleted(taskId, token) {
    try {
      // Atualizar tarefa na API com campo personalizado ou categoria
      const updateData = {
        data: {
          type: 'tasks',
          id: taskId,
          attributes: {
            // USAR: Campo dispon√≠vel para marcar como conclu√≠da
            observations: 'STATUS:COMPLETED', // ou outro campo dispon√≠vel
            // OU usar categoria espec√≠fica se dispon√≠vel
          }
        }
      };
      
      const response = await fetch(`https://web.monde.com.br/api/v2/tasks/${taskId}`, {
        method: 'PATCH',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.api+json',
          'Content-Type': 'application/vnd.api+json'
        },
        body: JSON.stringify(updateData)
      });
      
      if (response.ok) {
        this.completedTasks.add(taskId);
        this.statusMapping.set(taskId, 'completed');
      }
      
      return response;
    } catch (error) {
      console.error('Erro ao marcar como conclu√≠da:', error);
    }
  }
  
  // Deletar tarefa fisicamente
  async deleteTask(taskId, token) {
    try {
      const response = await fetch(`https://web.monde.com.br/api/v2/tasks/${taskId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.api+json',
          'Content-Type': 'application/vnd.api+json'
        }
      });
      
      if (response.ok) {
        this.deletedTasks.add(taskId);
        this.statusMapping.set(taskId, 'deleted');
      }
      
      return response;
    } catch (error) {
      console.error('Erro ao deletar tarefa:', error);
    }
  }
  
  // Obter tarefas por status
  async getTasksByStatus(status, token) {
    const allTasks = await this.getAllTasks(token);
    
    switch (status) {
      case 'completed':
        return allTasks.filter(task => 
          this.isTaskCompleted(task) && !this.isTaskDeleted(task.id)
        );
      case 'active':
        return allTasks.filter(task => 
          !this.isTaskCompleted(task) && !this.isTaskDeleted(task.id)
        );
      case 'deleted':
        // Tarefas deletadas n√£o aparecem na API, usar hist√≥rico local
        return Array.from(this.deletedTasks).map(id => ({ id, status: 'deleted' }));
      default:
        return allTasks;
    }
  }
  
  // Verificar se tarefa est√° conclu√≠da
  isTaskCompleted(task) {
    // IMPLEMENTAR baseado na estrat√©gia que funcionar
    return (
      this.completedTasks.has(task.id) ||
      (task.attributes.observations && task.attributes.observations.includes('STATUS:COMPLETED')) ||
      // Adicionar outras verifica√ß√µes baseadas nos campos dispon√≠veis
      false
    );
  }
  
  // Verificar se tarefa foi deletada
  isTaskDeleted(taskId) {
    return this.deletedTasks.has(taskId);
  }
  
  async getAllTasks(token) {
    const response = await fetch('https://web.monde.com.br/api/v2/tasks', {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Accept': 'application/vnd.api+json',
        'Content-Type': 'application/vnd.api+json'
      }
    });
    
    const data = await response.json();
    return data.data || [];
  }
}
```

## IMPLEMENTA√á√ÉO RECOMENDADA

### Passo 1: Verificar Campo 'situacao' (PRIORIT√ÅRIO)
```javascript
// FOCO: Verificar especificamente o campo 'situacao' ou 'situation'
async function verificarCampoSituacao(token) {
  try {
    console.log('=== VERIFICANDO CAMPO SITUA√á√ÉO ===');
    
    const response = await fetch('https://web.monde.com.br/api/v2/tasks', {
      headers: {
        'Authorization': `Bearer ${token}`,
        'Accept': 'application/vnd.api+json',
        'Content-Type': 'application/vnd.api+json'
      }
    });
    
    const data = await response.json();
    
    if (data.data && data.data.length > 0) {
      data.data.forEach((task, index) => {
        console.log(`\n--- TAREFA ${index + 1} ---`);
        console.log(`ID: ${task.id}`);
        
        // VERIFICAR CAMPOS ESPEC√çFICOS DE SITUA√á√ÉO
        const camposSituacao = ['situacao', 'situation', 'status', 'state', 'task_status'];
        
        camposSituacao.forEach(campo => {
          if (task.attributes[campo] !== undefined) {
            console.log(`‚úì CAMPO ENCONTRADO - ${campo}: "${task.attributes[campo]}"`);
          }
        });
        
        // MOSTRAR TODOS OS CAMPOS PARA AN√ÅLISE
        console.log('Todos os attributes:', Object.keys(task.attributes));
      });
    }
    
    // TESTAR FILTROS ESPEC√çFICOS
    await testarFiltrosSituacao(token);
    
  } catch (error) {
    console.error('Erro na verifica√ß√£o:', error);
  }
}

// IMPLEMENTA√á√ÉO ESPEC√çFICA BASEADA NO CAMPO SITUA√á√ÉO
class MondeTaskManager {
  constructor() {
    this.statusField = 'situacao'; // Campo confirmado pela interface
  }
  
  // Buscar tarefas por situa√ß√£o espec√≠fica
  async getTasksBySituacao(token, situacao) {
    const endpoints = [
      `https://web.monde.com.br/api/v2/tasks?filter[situacao]=${situacao}`,
      `https://web.monde.com.br/api/v2/tasks?filter[situation]=${situacao}`,
      `https://web.monde.com.br/api/v2/tasks?situacao=${situacao}`
    ];
    
    for (const url of endpoints) {
      try {
        console.log(`Testando endpoint: ${url}`);
        
        const response = await fetch(url, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'Accept': 'application/vnd.api+json',
            'Content-Type': 'application/vnd.api+json'
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          console.log(`‚úì SUCESSO com ${url}`);
          return data;
        }
      } catch (error) {
        console.log(`‚úó Falhou: ${url}`, error.message);
      }
    }
    
    throw new Error(`N√£o foi poss√≠vel buscar tarefas com situa√ß√£o: ${situacao}`);
  }
  
  // Buscar apenas tarefas ATIVAS
  async getActiveTasks(token) {
    return await this.getTasksBySituacao(token, 'ativa');
  }
  
  // Buscar apenas tarefas CONCLU√çDAS
  async getCompletedTasks(token) {
    return await this.getTasksBySituacao(token, 'concluida');
  }
  
  // Buscar apenas tarefas EXCLU√çDAS/DELETADAS
  async getDeletedTasks(token) {
    return await this.getTasksBySituacao(token, 'excluida');
  }
  
  // Marcar tarefa como conclu√≠da (PATCH)
  async markTaskAsCompleted(taskId, token) {
    const updateData = {
      data: {
        type: 'tasks',
        id: taskId,
        attributes: {
          situacao: 'concluida' // ou o valor correto encontrado
        }
      }
    };
    
    try {
      const response = await fetch(`https://web.monde.com.br/api/v2/tasks/${taskId}`, {
        method: 'PATCH',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.api+json',
          'Content-Type': 'application/vnd.api+json'
        },
        body: JSON.stringify(updateData)
      });
      
      if (response.ok) {
        console.log(`‚úì Tarefa ${taskId} marcada como conclu√≠da`);
        return await response.json();
      }
      
      throw new Error(`Erro HTTP: ${response.status}`);
    } catch (error) {
      console.error('Erro ao marcar como conclu√≠da:', error);
      throw error;
    }
  }
  
  // Marcar tarefa como exclu√≠da (SEM deletar fisicamente)
  async markTaskAsDeleted(taskId, token) {
    const updateData = {
      data: {
        type: 'tasks',
        id: taskId,
        attributes: {
          situacao: 'excluida' // ou o valor correto encontrado
        }
      }
    };
    
    try {
      const response = await fetch(`https://web.monde.com.br/api/v2/tasks/${taskId}`, {
        method: 'PATCH',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Accept': 'application/vnd.api+json',
          'Content-Type': 'application/vnd.api+json'
        },
        body: JSON.stringify(updateData)
      });
      
      if (response.ok) {
        console.log(`‚úì Tarefa ${taskId} marcada como exclu√≠da`);
        return await response.json();
      }
      
      throw new Error(`Erro HTTP: ${response.status}`);
    } catch (error) {
      console.error('Erro ao marcar como exclu√≠da:', error);
      throw error;
    }
  }
}

// EXEMPLO DE USO ESPEC√çFICO
async function exemploUsoMonde() {
  const token = 'SEU_TOKEN_AQUI';
  const taskManager = new MondeTaskManager();
  
  try {
    // 1. Verificar o campo situa√ß√£o primeiro
    await verificarCampoSituacao(token);
    
    // 2. Buscar tarefas por situa√ß√£o
    console.log('\n=== TAREFAS ATIVAS ===');
    const ativas = await taskManager.getActiveTasks(token);
    console.log(ativas);
    
    console.log('\n=== TAREFAS CONCLU√çDAS ===');
    const concluidas = await taskManager.getCompletedTasks(token);
    console.log(concluidas);
    
    console.log('\n=== TAREFAS EXCLU√çDAS ===');
    const excluidas = await taskManager.getDeletedTasks(token);
    console.log(excluidas);
    
    // 3. Testar mudan√ßa de status
    // await taskManager.markTaskAsCompleted('ID_DA_TAREFA', token);
    // await taskManager.markTaskAsDeleted('ID_DA_TAREFA', token);
    
  } catch (error) {
    console.error('Erro no exemplo:', error);
  }
}
```
```

### Passo 2: Implementar Solu√ß√£o Espec√≠fica do Monde
```javascript
// IMPLEMENTA√á√ÉO FINAL - Use esta ap√≥s confirmar o campo "situacao"
const taskManager = new MondeTaskManager();

async function implementacaoFinal() {
  const token = 'SEU_TOKEN_AQUI';
  
  try {
    // ETAPA 1: Verificar campo situa√ß√£o
    console.log('ETAPA 1: Verificando campo situacao...');
    await verificarCampoSituacao(token);
    
    // ETAPA 2: Implementar filtros espec√≠ficos
    console.log('\nETAPA 2: Testando filtros...');
    
    // Buscar tarefas ativas
    const tarefasAtivas = await taskManager.getActiveTasks(token);
    console.log(`‚úì Encontradas ${tarefasAtivas.data?.length || 0} tarefas ativas`);
    
    // Buscar tarefas conclu√≠das 
    const tarefasConcluidas = await taskManager.getCompletedTasks(token);
    console.log(`‚úì Encontradas ${tarefasConcluidas.data?.length || 0} tarefas conclu√≠das`);
    
    // Buscar tarefas exclu√≠das
    const tarefasExcluidas = await taskManager.getDeletedTasks(token);
    console.log(`‚úì Encontradas ${tarefasExcluidas.data?.length || 0} tarefas exclu√≠das`);
    
    // ETAPA 3: Demonstrar mudan√ßa de status
    console.log('\nETAPA 3: Testando mudan√ßa de status...');
    
    if (tarefasAtivas.data && tarefasAtivas.data.length > 0) {
      const primeiraAtiva = tarefasAtivas.data[0];
      console.log(`Testando com tarefa ID: ${primeiraAtiva.id}`);
      
      // DESCOMENTAR PARA TESTAR MUDAN√áA DE STATUS:
      // await taskManager.markTaskAsCompleted(primeiraAtiva.id, token);
      // console.log('‚úì Tarefa marcada como conclu√≠da');
    }
    
    return {
      ativas: tarefasAtivas,
      concluidas: tarefasConcluidas, 
      excluidas: tarefasExcluidas
    };
    
  } catch (error) {
    console.error('Erro na implementa√ß√£o:', error);
    throw error;
  }
}

// EXECU√á√ÉO PRINCIPAL
implementacaoFinal()
  .then(resultado => {
    console.log('\nüéâ IMPLEMENTA√á√ÉO CONCLU√çDA COM SUCESSO!');
    console.log('Resultado:', resultado);
  })
  .catch(error => {
    console.error('‚ùå ERRO NA IMPLEMENTA√á√ÉO:', error);
  });
```

## VALORES CONFIRMADOS PARA O CAMPO 'situacao':
- **`"ativa"`** - Tarefa ativa/em andamento
- **`"concluida"`** - Tarefa conclu√≠da/finalizada  
- **`"excluida"`** - Tarefa exclu√≠da/deletada (mas ainda existe no banco)

## ENDPOINTS FINAIS RECOMENDADOS:
```javascript
// FILTROS ESPEC√çFICOS QUE DEVEM FUNCIONAR:
const endpoints = {
  ativas: 'https://web.monde.com.br/api/v2/tasks?filter[situacao]=ativa',
  concluidas: 'https://web.monde.com.br/api/v2/tasks?filter[situacao]=concluida',
  excluidas: 'https://web.monde.com.br/api/v2/tasks?filter[situacao]=excluida'
};
```

## CAMPOS ESPEC√çFICOS DA API MONDE (CONFIRMADOS)
**CAMPO PRINCIPAL**: `situacao` ou `situation` (baseado na interface mostrada)

Valores esperados:
- `"ativa"` ou `"active"` - Tarefa ativa
- `"concluida"` ou `"completed"` - Tarefa conclu√≠da  
- `"excluida"` ou `"deleted"` - Tarefa exclu√≠da/deletada

**OUTROS CAMPOS PARA VERIFICAR:**
- `status`
- `state` 
- `situacao`
- `situation`
- `task_status`
- `completed_at`
- `deleted_at`
- `excluded_at`

## PR√ìXIMOS PASSOS (ESPEC√çFICOS PARA MONDE)
1. **Execute `verificarCampoSituacao(token)`** - Confirma o campo "situacao"
2. **Teste os filtros**: `/api/v2/tasks?filter[situacao]=ativa|concluida|excluida`
3. **Use a classe `MondeTaskManager`** - J√° otimizada para a API Monde
4. **Implemente `markTaskAsCompleted()` e `markTaskAsDeleted()`** - Para mudan√ßas de status
5. **Teste com `implementacaoFinal()`** - Execu√ß√£o completa

## DIFEREN√áA CONFIRMADA:
- **Tarefa CONCLU√çDA**: `situacao: "concluida"` (tarefa finalizada, mas vis√≠vel)
- **Tarefa EXCLU√çDA**: `situacao: "excluida"` (tarefa "deletada", mas ainda no banco)
- **Dele√ß√£o F√çSICA**: `DELETE /tasks/:id` (remove completamente do banco)

## SOLU√á√ÉO FINAL:
```javascript
// USO DIRETO - Cole isso no Replit:
const monde = new MondeTaskManager();

// Buscar por tipo espec√≠fico:
const ativas = await monde.getActiveTasks(token);
const concluidas = await monde.getCompletedTasks(token); 
const excluidas = await monde.getDeletedTasks(token);

// Mudar status sem perder dados:
await monde.markTaskAsCompleted(taskId, token);   // marca como conclu√≠da
await monde.markTaskAsDeleted(taskId, token);     // marca como exclu√≠da
```

## IMPORTANTE
- Sempre fa√ßa backup dos IDs das tarefas antes de deletar
- Teste primeiro em ambiente de desenvolvimento
- Documente os campos espec√≠ficos que a API do Monde utiliza para status